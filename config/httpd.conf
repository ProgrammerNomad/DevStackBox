# Minimal Apache Configuration for DevStackBox
ServerRoot "C:/box/DevStackBox/apache"
PidFile "C:/box/DevStackBox/logs/httpd.pid"
Listen 80

# Essential modules
LoadModule dir_module modules/mod_dir.so
LoadModule mime_module modules/mod_mime.so
LoadModule authz_core_module modules/mod_authz_core.so
LoadModule authz_host_module modules/mod_authz_host.so
LoadModule log_config_module modules/mod_log_config.so
LoadModule cgi_module modules/mod_cgi.so
LoadModule alias_module modules/mod_alias.so
LoadModule actions_module modules/mod_actions.so
LoadModule headers_module modules/mod_headers.so

ServerName localhost:80
DocumentRoot "C:/box/DevStackBox/www"

<Directory "C:/box/DevStackBox/www">
    Require all granted
    DirectoryIndex index.php index.html index.htm
    
    # Handle PHP files through CGI
    AddHandler php-script .php
    
    <Files "*.php">
        SetHandler php-script
    </Files>
</Directory>

# MIME Types
TypesConfig conf/mime.types
AddType text/html .html .htm

# PHP Configuration (CGI Mode)
ScriptAlias /php/ "C:/box/DevStackBox/php/8.2/"
Action php-script /php/php-cgi.exe
AddHandler php-script .php
AddType application/x-httpd-php .php

# Directory for PHP CGI scripts
<Directory "C:/box/DevStackBox/php/8.2">
    AllowOverride None
    Options ExecCGI
    Require all granted
</Directory>

# Set CGI timeout
ScriptInterpreterSource Registry-Strict

# Error and Access logs
ErrorLog "C:/box/DevStackBox/logs/error.log"
CustomLog "C:/box/DevStackBox/logs/access.log" common

# Security
ServerTokens Prod
ServerSignature Off

# Disable .htaccess files completely
AccessFileName ""

# phpMyAdmin Configuration
Alias /phpmyadmin "C:/box/DevStackBox/phpmyadmin"

<Directory "C:/box/DevStackBox/phpmyadmin">
    Options None
    AllowOverride Limit
    Require ip 127.0.0.1
    Require ip ::1
    DirectoryIndex index.php
    
    # Handle PHP files through CGI
    AddHandler php-script .php
    
    # Security rules
    <Files "*.php">
        SetHandler php-script
    </Files>
    
    <Files "config.inc.php">
        Require all denied
    </Files>
    
    # Prevent access to version control and other sensitive files
    <Files ~ "^\.">
        Require all denied
    </Files>
    
    <Files ~ "\.(sql|log)$">
        Require all denied
    </Files>
</Directory>

# Deny access to sensitive phpMyAdmin directories
<Directory "C:/box/DevStackBox/phpmyadmin/config">
    Require all denied
</Directory>

<Directory "C:/box/DevStackBox/phpmyadmin/tmp">
    Require all denied
</Directory>

<Directory "C:/box/DevStackBox/phpmyadmin/libraries">
    Require all denied
</Directory>

<Directory "C:/box/DevStackBox/phpmyadmin/setup">
    Require all denied
</Directory>
